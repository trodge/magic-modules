resource "google_vertex_ai_endpoint_traffic_split" "<%= ctx[:primary_resource_id] %>" {
  endpoint = google_vertex_ai_endpoint.minimal.name
  location = "us-central1"
  traffic_split = {
    (google_vertex_ai_model_deployment.minimal.deployed_model_id) = 100
  }
}

resource "google_vertex_ai_model_deployment" "minimal" {
  dedicated_resources {
    machine_spec {
      machine_type = "n1-standard-2"
    }
    min_replica_count = 1
  }
  endpoint = google_vertex_ai_endpoint.minimal.name
  model    = google_vertex_ai_model.minimal.id
  location = "us-central1"
}

resource "google_vertex_ai_model" "minimal" {
  container_spec {
    image_uri = "us-docker.pkg.dev/vertex-ai/prediction/xgboost-cpu.1-5:latest"
  }
  display_name = "sample-model"
  location     = "us-central1"
  artifact_uri = "gs://cloud-samples-data/vertex-ai/google-cloud-aiplatform-ci-artifacts/models/iris_xgboost/"
}

resource "google_vertex_ai_endpoint" "minimal" {
  display_name = "sample-endpoint"
  location     = "us-central1"
}
